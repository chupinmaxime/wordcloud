wordcloud

mplib

drawing wordclouds
with METAPOST and Lua

graphism

algorithm

METAPOST

Wordcloud
mathematics

LuaTEX

CTAN

LATEX

Lua
latexmp

code

Contributor
Maxime Chupin
notezik@gmail.com

Version 0.1, 2023, August, 3rd
https://plmlab.math.cnrs.fr/mchupin/wordcloud

Abstract
These METAPOST and LuaLATEX packages allows to draw wordclouds from
a list of words and weights. The algorithm is implemented with METAPOST
whereas Lua is used to parse LATEX commands and to build the list of words
and weights from a text file. The LuaLATEX side require luamplib.

https://plmlab.math.cnrs.fr/mchupin/wordcloud
https://github.com/chupinmaxime/wordcloud

Contents
1

Installation
1.1 With TEXlive under Linux or macOS . . . . . . . . . . . . . . . . . . .
1.2 With MikTEX and Windows . . . . . . . . . . . . . . . . . . . . . . . .
1.3 Dependencies . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

2 METAPOST side
2.1 Description of the algorithm
2.2 Main command . . . . . . . .
2.3 Parameters . . . . . . . . . .
2.3.1 Colors . . . . . . . . .
2.3.2 Scaling . . . . . . . . .
2.3.3 Margins . . . . . . . .

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

3 LuaLATEX side

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

2
2
3
3
3
3
4
5
5
6
6
6

This package is in beta version‚Äîdo not hesitate to report bugs, as well as
requests for improvement, or better: to help me to improve it.

1

Installation

wordcloud is on ctan and can also be installed via the package manager of your
distribution.
https://www.ctan.org/pkg/wordcloud

1.1

With TEXlive under Linux or macOS

To install wordcloud with TEXLive, you will have to create the directory texmf in
your home.
mkdir ~/texmf

Then, you will have to place the wordcloud.mp file in
~/texmf/metapost/huffman/
2

You will also have to place the wordcloud.lua file in
~/texmf/scripts/wordcloud/
And finally, you will have to place the wordcloud.sty file in
~/texmf/tex/latex/wordcloud/
Once this is done, wordcloud will be loaded with the classic METAPOST input
code
input wordcloud
And for the LuaLATEX side, wordcloud will be loaded with
\usepackage{wordcloud}

1.2

With MikTEX and Windows

These two systems are unknown to the author of wordcloud, so we refer you to
the MikTEXdocumentation concerning the addition of local packages:
http://docs.miktex.org/manual/localadditions.html

1.3

Dependencies

wordcloud depends, of course on METAPOST [4] and metapost-colorbrewer [5],
and‚Äîif wordcloud is not used with LuaLATEX [3] and the luamplib package [1]‚Äîthe
latexmp package [2].

2 METAPOST side
2.1

Description of the algorithm

Given a set of words and weights, we first use a scale function of the weights to
scale the words. In this beta version of wordcloud, we only provide a log-based
function1 .
Then, we compute a spiral line starting at the center2 .
Then the algorithm is quite simple:
Require: set of words (ùëäùëñ )ùëñ‚àà{1,‚Ä¶,ùëÅ and corresponding weight (ùë§ùëñ )ùëñ‚àà{1,‚Ä¶,ùëÅ , and a spiral line ùëÜ
1: for all ùëñ ‚àà {1, ‚Ä¶ , ùëÅ} do
2:
Place ùëäùëñ at the start of ùëÜ
3:
repeat
4:
Set ùëèdraw ‚à∂= true
1
2

Other scale options could be provided in the next versions.
There is variants of the algorithm that use different line: squared spiral, etc.

3

for all ùëó ‚àà 1, ‚Ä¶ , ùëñ do
if ùëäùëñ ‚à© ùëäùëó ‚â† ‚àÖ then
7:
Set ùëèdraw ‚à∂= false
8:
end if
9:
end for
10:
if ùëèdraw == true then
11:
Draw ùëäùëñ
12:
else
13:
Move ùëäùëñ along ùëÜ
14:
end if
15:
until ùëäùëñ is drawn
16: end for
The hard part is making it perform efficiently! According to Jonathan Feinberg, Wordle3 uses a combination of hierarchical bounding boxes and quadtrees
to achieve reasonable speeds. Here, with METAPOST, we compute intersections
with the bounding box of the word.
5:
6:

Remark
The words with METAPOST are built with the textext() function of latexmp or luamplib. We are trying to use the bounding boxes of the letters when we get an intersection between ‚Äúglobal‚Äù bounding boxes to allow
placing words nearer of each other. Unfortunately, this does not work for
the moment. Any help is welcomed.
We first tried to compute intersections between words by decomposing
the letter using their contours and compute intersection of contours (with
intersectiontimes). Unfortunately, this is much too slow.

2.2

Main command

The main command is
draw_wordcloud(‚ü®words‚ü©, ‚ü®weights‚ü©,‚ü®rotation‚ü©,‚ü®size‚ü©)
‚ü®words‚ü©: array of strings ;
‚ü®weights‚ü©: array of numerics ;
‚ü®rotation‚ü©: angle for wordcloud drawing;
‚ü®size‚ü©: number of elements in arrays.
Exemple METAPOST 1
input wordcloud
beginfig(0);
string words[];
3

One of the first web application to build wordcloud.

4

METAPOST

numeric weights[];
words[1]:="\LaTeX";
words[2]:="\hologo{METAPOST}";
words[3]:="Document";
words[4]:="Lua";
words[5]:="\TeX";
weights[1]:=5;
weights[2]:=4;
weights[3]:=3.5;
weights[4]:=3;
weights[5]:=3;
draw_wordcloud(words,weights,0,5);
endfig;

Lua

Document

LATEX
TEX

Remark
The ‚Äúunity‚Äù of weights is not really important because internally, wordcloud
compute new weights (with a min and a max, etc.) to work with the internal
scaling function.

2.3

Parameters

There are few parameters.
2.3.1

Colors

You can use set of colors to draw the wordcloud. For that, you have to use the
following command:
wordcloud_use_color(‚ü®bool‚ü©)
‚ü®bool‚ü©: boolean true or false (default false).
wordcloud provides a set of five colors using the METAPOST package
metapost-colorbrewer [5]. wordcloud defines an array of colors and a numeric
to set the colors to use.
wordcloud_colors[1]:=Reds[3][3];
wordcloud_colors[2]:=Greens[3][3];
wordcloud_colors[3]:=Blues[3][3];
wordcloud_colors[4]:=Oranges[3][3];

5

wordcloud_colors[5]:=black;
wordcloud_colors_number:=5;
Feel free to modify that variables to customize the colors.
2.3.2

Scaling

You can globally scale the picture using the following command:
set_wordcloud_scale(‚ü®scale‚ü©)
‚ü®scale‚ü©: numeric.
2.3.3

Margins

You can adjust the margins of the global bounding boxes of words using the
following command:
set_box_margin(‚ü®dim‚ü©)
‚ü®dim‚ü©: a dimension with units (default 0.3pt).

3

LuaLATEX side

wordcloud provides a LuaLATEX package. It uses the package luamplib to interpret
a METAPOST code produced by Lua.
The first LATEX command provided by wordcloud is:
\wordcloud[‚ü®options‚ü©]{‚ü®list of words and weights‚ü©}
where
‚ü®list of words and weights‚ü©: is a list of couples of the form (word1,weight1)
;(word2,weight2);(word3,weight3);...
The second LATEX command allows to read a text file, to build the list of words
and weights and draw the wordcloud up to a certain number of words.
\wordcloudFile[‚ü®options‚ü©]{‚ü®text file‚ü©}{‚ü®number of words‚ü©}
where:
‚ü®text file‚ü©: is a text file to analyze and from which the wordcloud is build ;
‚ü®number of words‚ü©: is the number of words composing the wordcloud.
Both of these functions (\wordcloud and \wordcloudFile) have the
same options:
scale=‚ü®value‚ü©: to scale the picture4 ;
4
Beware that scaling increases the computation time and the values manipulated by
METAPOST.

6

margin=‚ü®value with units‚ü©: to adjust the margins (default 0.3pt) ;
rotate=‚ü®angle‚ü©: to rotate (degrees) the words with ¬±‚ü®angle‚ü© alternatively
(default 0) ;
usecolor: to use color for word drawing (boolean, default false) as described in section 2.3.1 ;
colors=‚ü®list of colors‚ü©: to define a new set of colors as described in section 2.3.15 .
Here an example:
Exemple LATEX 1
\wordcloud[scale=1,rotate=45,margin=0.5pt,usecolor,colors={red
!40,blue!40,green!20!black}]{(Wordcloud,10);(\\hologo{
METAPOST},6);(\\LaTeX,7);(Lua,4);(algorithm,3);(code,2);(
mathematics,2);(CTAN,2);(mplib,4);(\\hologo{LuaTeX},4);(
latexmp,3);(graphism,2)}

W L
M o ua
ET r
APdc
OSlo
T ud

Lu

p
xm X
te
la
aT E

s

ic

at

al
go
rit
hm

sm

m

he

gr
ap
hi

at

X

co
de

m

AN
CT

ALT E

ib

pl

m

References
[1] Hans Hagen et al. The luamplib package. Use LuaTeX‚Äôs built-in MetaPost
interpreter. Version 2.23.0. Jan. 12, 2022. url: https://ctan.org/pkg/
luamplib.
[2] Jens-Uwe Morawski. The latexMP package. Interface for LATEX-based typesetting in MetaPost. Version 1.2.1. June 21, 2020. url: https://ctan.org/
pkg/latexmp.
[3] Manuel P√©gouri√©-Gonnard. The lualatex-doc package. A guide to use
of LATEX with LuaTeX. June 24, 2016. url: https : / / ctan . org / pkg /
lualatex-doc.
[4] The MetaPost Team and John Hobby. The metapost package. A development of Metafont for creating graphics. Aug. 26, 2021. url: https://ctan.
org/pkg/metapost.
[5] Toby Thurston. The metapost-colorbrewer package. An implementation of the colorbrewer2.org colours for MetaPost. Sept. 25, 2018. url:
https://ctan.org/pkg/metapost-colorbrewer.
5
This needs xcolor because the colors are converted to rgb coding and then transferred to
METAPOST.

7

Command Index
\wordcloud, 6
\wordcloudFile, 6

set_wordcloud_scale, 6
wordcloud_colors, 5
wordcloud_colors_number, 5
wordcloud_use_color, 5

draw_wordcloud, 4
set_box_margin, 6

8

ÔøΩ function

input

ÔøΩÔøΩ

The

https

command You

end

file

ÔøΩ

you

Lua set

luamplib

use

ctan for

pkg

true

compute
following

9

draw

latexmp

url
bounding

LuaLATEX

spiral

colors

algorithm

package

ÔøΩdraw

words

wordcloud
weights
texmf scale

With

side

metapost

colorbrewer

using

METAPOST

first

will

MetaPost
boxes

org place

LATEX


