\NeedsTeXFormat{LaTeX2e}%
\def\PackageName{wordcloud}%
\def\fileversion{v0.1}%
\def\filedate{2023/07/26}%
\ProvidesPackage{wordcloud}[\filedate\space\fileversion]%
%
% package to load
\RequirePackage{luamplib}%

%
% load the lua code
\directlua{require("wordcloud.lua")}%

\ExplSyntaxOn

% variable globale
\tl_new:N \g__wc_wordcloud_scale_tl

% definitions des clés/valeurs pour la commande \wordcloud
\keys_define:nn{wc/wordcloud}{%
  scale .tl_gset:N = \g__wc_wordcloud_scale_tl,
  scale .value_required:n = true,
  rotate .tl_gset:N = \g__wc_wordcloud_rotate_tl,
  rotate .value_required:n = true,
  margin .tl_gset:N = \g__wc_wordcloud_margin_tl,
  margin .value_required:n = true,
}
% function to build a wordcloud from a list of the form :
% (word1,weight1);(word2,weight2);etc.
\NewDocumentCommand\wordcloud{ o m }{%
  % mandatory argument : list (word1,weight1);(word2,weight2);etc.
  % optional argument :
  % scale=<value> (default 1)

  % pour les clés à valeur par défaut
  \keys_set:nn { wc/wordcloud } { scale=1 } %
  \keys_set:nn { wc/wordcloud } { rotate=0 } %
  \keys_set:nn { wc/wordcloud } { margin=0.3pt } %
  
  \IfNoValueF {#1}
  {
      \keys_set:nn { wc/wordcloud } { #1 }
  }
  %\show {coucous}
  \directlua{%
    %tex.sprint("test")
    wc_build_wordcloud("#2",\tl_use:N \g__wc_wordcloud_rotate_tl,\tl_use:N \g__wc_wordcloud_scale_tl,"\tl_use:N \g__wc_wordcloud_margin_tl")
  }%
}



\ExplSyntaxOff